
{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Stamp Display -->
        <div class="glass-effect rounded-lg shadow-2xl p-8 border border-white/20">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">
                <i class="fas fa-stamp mr-2"></i>Digital Corporate Stamp
            </h2>
            
            <div class="flex justify-center mb-6">
                <div id="stamp-container" class="relative">
                    <svg id="corporate-stamp" width="280" height="280" viewBox="0 0 280 280" class="stamp-shadow">
                        <!-- Transparent background -->
                        <defs>
                            <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                                <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
                            </filter>
                        </defs>
                        
                        <!-- Outer decorative border -->
                        <circle cx="140" cy="140" r="135" fill="none" stroke="#1e40af" stroke-width="3" opacity="0.8"/>
                        <circle cx="140" cy="140" r="130" fill="none" stroke="#1e40af" stroke-width="1" opacity="0.6"/>
                        
                        <!-- Chain pattern border -->
                        <circle cx="140" cy="140" r="125" fill="none" stroke="#374151" stroke-width="2" stroke-dasharray="6 3" opacity="0.7"/>
                        
                        <!-- Inner circles -->
                        <circle cx="140" cy="140" r="120" fill="none" stroke="#1e40af" stroke-width="2" opacity="0.8"/>
                        <circle cx="140" cy="140" r="100" fill="none" stroke="#6b7280" stroke-width="1" stroke-dasharray="2 3" opacity="0.5"/>
                        
                        <!-- Top curved text path -->
                        <path id="top-curve" d="M 30.4 140 A 110 110 0 0 1 250 140" fill="none"/>
                        
                        <!-- Bottom curved text path -->
                        <path id="bottom-curve" d="M 250 140 A 110 110 0 0 1 30 140" fill="none"/>
                        
                        <!-- Top curved company name -->
                        <text font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1e40af" opacity="0.9">
                            <textPath href="#top-curve" startOffset="50%" text-anchor="middle">
                                <tspan id="stamp-company-top">SEIKO ELECTRIC CO. LTD.</tspan>
                            </textPath>
                        </text>
                        
                        <!-- Bottom curved department -->
                        <text font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#374151" opacity="0.8">
                            <textPath href="#bottom-curve" startOffset="50%" text-anchor="middle">
                                <tspan id="stamp-department-bottom">{{ department.upper() }} DIVISION</tspan>
                            </textPath>
                        </text>
                        
                        <!-- Center content -->
                        <text x="140" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1e40af" opacity="0.8">
                            <tspan>CORPORATE SEAL</tspan>
                        </text>
                        
                        <!-- Decorative line -->
                        <line x1="110" y1="135" x2="170" y2="135" stroke="#6b7280" stroke-width="1" opacity="0.6"/>
                        
                        <!-- Position -->
                        <text x="140" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="semibold" fill="#374151" opacity="0.7">
                            <tspan id="stamp-position">{{ position.upper() }}</tspan>
                        </text>
                        
                        <!-- User name -->
                        <text x="140" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1e40af" opacity="0.9">
                            <tspan id="stamp-username">{{ full_name.upper() }}</tspan>
                        </text>
                        
                        <!-- Date -->
                        <text x="140" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#6b7280" opacity="0.8">
                            <tspan id="stamp-date">{{ current_date }}</tspan>
                        </text>
                        
                        <!-- Decorative elements -->
                        <text x="70" y="190" text-anchor="middle" font-size="16" fill="#1e40af" opacity="0.7">★</text>
                        <text x="210" y="190" text-anchor="middle" font-size="16" fill="#1e40af" opacity="0.7">★</text>
                        
                        <!-- Website reference (small) -->
                        <text x="140" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#6b7280" opacity="0.5">
                            <tspan>www.seiko-denki.co.jp</tspan>
                        </text>
                    </svg>
                </div>
            </div>
            
            <div class="flex justify-center space-x-4">
                <button onclick="copyStampImage()" 
                        class="flex items-center space-x-2 bg-green-500/80 hover:bg-green-600/80 text-white py-2 px-4 rounded-lg transition-all duration-300">
                    <i class="fas fa-copy"></i>
                    <span>Copy Stamp</span>
                </button>
                
                <button onclick="downloadStamp()" 
                        class="flex items-center space-x-2 bg-purple-500/80 hover:bg-purple-600/80 text-white py-2 px-4 rounded-lg transition-all duration-300">
                    <i class="fas fa-download"></i>
                    <span>Download PNG</span>
                </button>
            </div>
        </div>
        
        <!-- Controls -->
        <div class="glass-effect rounded-lg shadow-2xl p-8 border border-white/20">
            <h3 class="text-xl font-bold text-white mb-6">
                <i class="fas fa-edit mr-2"></i>Stamp Configuration
            </h3>
            
            <div class="space-y-6">
                <div class="bg-white/10 rounded-lg p-4 border border-white/20">
                    <h4 class="text-white font-semibold mb-3">Company Information</h4>
                    <div class="space-y-2 text-white/80 text-sm">
                        <p><strong>Company:</strong> {{ company }}</p>
                        <p><strong>Department:</strong> {{ department }}</p>
                        <p><strong>Website:</strong> <a href="{{ website }}" target="_blank" class="text-blue-300 hover:underline">{{ website }}</a></p>
                    </div>
                </div>
                
                <div>
                    <label for="edit-full-name" class="block text-sm font-medium text-white mb-2">
                        <i class="fas fa-user mr-2"></i>Full Name
                    </label>
                    <input type="text" id="edit-full-name" value="{{ full_name }}" 
                           class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-white/50 text-white placeholder-white/60"
                           onkeyup="updateStamp()">
                </div>
                
                <div>
                    <label for="edit-position" class="block text-sm font-medium text-white mb-2">
                        <i class="fas fa-id-badge mr-2"></i>Position
                    </label>
                    <input type="text" id="edit-position" value="{{ position }}" 
                           class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-white/50 text-white placeholder-white/60"
                           onkeyup="updateStamp()">
                </div>
                
                <div>
                    <label for="edit-date" class="block text-sm font-medium text-white mb-2">
                        <i class="fas fa-calendar mr-2"></i>Date
                    </label>
                    <input type="date" id="edit-date" value="{{ current_date }}" 
                           class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-white/50 text-white"
                           onchange="updateStamp()">
                </div>
            </div>
            
            <div id="copy-message" class="hidden mt-4 p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-center">
                <i class="fas fa-check-circle mr-2"></i>
                <span id="message-text">Stamp copied successfully!</span>
            </div>
        </div>
    </div>
</div>

<script>
function updateStamp() {
    const fullName = document.getElementById('edit-full-name').value;
    const position = document.getElementById('edit-position').value;
    const date = document.getElementById('edit-date').value;
    
    document.getElementById('stamp-username').textContent = fullName.toUpperCase();
    document.getElementById('stamp-position').textContent = position.toUpperCase();
    document.getElementById('stamp-date').textContent = date;
}

async function copyStampImage() {
    try {
        const svg = document.getElementById('corporate-stamp');
        const svgData = new XMLSerializer().serializeToString(svg);
        
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        canvas.width = 280;
        canvas.height = 280;
        
        img.onload = async function() {
            // Keep transparent background
            ctx.drawImage(img, 0, 0);
            
            try {
                canvas.toBlob(async function(blob) {
                    try {
                        await navigator.clipboard.write([
                            new ClipboardItem({
                                'image/png': blob
                            })
                        ]);
                        showMessage('Transparent stamp image copied to clipboard!');
                    } catch (err) {
                        showMessage('Stamp copied (transparency may vary by application)');
                    }
                });
            } catch (err) {
                showMessage('Image copy not supported in this browser');
            }
        };
        
        const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
        const url = URL.createObjectURL(svgBlob);
        img.src = url;
        
    } catch (err) {
        showMessage('Failed to copy. Please try download instead.', 'error');
    }
}

function downloadStamp() {
    const svg = document.getElementById('corporate-stamp');
    const svgData = new XMLSerializer().serializeToString(svg);
    
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();
    
    canvas.width = 280;
    canvas.height = 280;
    
    img.onload = function() {
        ctx.drawImage(img, 0, 0);
        
        const link = document.createElement('a');
        const timestamp = new Date().toISOString().slice(0, 10);
        link.download = `seiko-electric-stamp-${timestamp}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
        
        showMessage('Stamp downloaded successfully!');
    };
    
    const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
    const url = URL.createObjectURL(svgBlob);
    img.src = url;
}

function showMessage(text, type = 'success') {
    const message = document.getElementById('copy-message');
    const messageText = document.getElementById('message-text');
    
    messageText.textContent = text;
    message.className = `mt-4 p-3 border rounded-lg text-center ${
        type === 'error' ? 'bg-red-500/20 border-red-500/30 text-red-300' : 'bg-green-500/20 border-green-500/30 text-green-300'
    }`;
    message.classList.remove('hidden');
    
    setTimeout(() => {
        message.classList.add('hidden');
    }, 4000);
}
</script>
{% endblock %}
    